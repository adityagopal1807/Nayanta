<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download Invoice | Nayanta Eyewear</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:20px; }
    .container { max-width:500px; margin:60px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
    h2 { text-align:center; margin-bottom:20px; color:#333; }
    input { width:100%; padding:12px; margin:10px 0; border:1px solid #ccc; border-radius:6px; }
    button { width:100%; padding:12px; background:#d32525; color:white; border:none; border-radius:6px; cursor:pointer; font-size:16px; }
    button:hover { background:#b01f1f; }
    .msg { margin-top:15px; text-align:center; font-size:14px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Download Invoice</h2>
    <input type="text" id="mobile" placeholder="Enter Mobile Number" />
    <button onclick="downloadInvoice()">Download Invoice</button>
    <div class="msg" id="msg"></div>
  </div>

  <script>
    const orders = {
      "9060488181": {
        invoiceNo: "9",
        date: "03/09/2025",
        customer: "Aryan",
        address: "Akshardham, Delhi",
        items: [
          { description: "Vincent Chase Eyeglasses (powered)", qty: 1, unit: 750.00, total: 750.00 }
          
        ],
        subtotal: 750.00,
        paid: 0.00,
        due: 750.00
      }
    };

    async function downloadInvoice() {
      const mobile = document.getElementById("mobile").value.trim();
      const msg = document.getElementById("msg");

      if (!orders[mobile]) {
        msg.style.color = "red";
        msg.textContent = "❌ Order not found for this mobile number!";
        return;
      }

      msg.style.color = "green";
      msg.textContent = "✅ Downloading Invoice!";

      const order = orders[mobile];
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Company info (left)
      doc.setFontSize(16);
      doc.setTextColor(40, 40, 40);
      doc.text("Nayanta Eyewear", 14, 20);

      doc.setFontSize(10);
      doc.setTextColor(80, 80, 80);
      doc.text("Greater Noida, Uttar Pradesh", 14, 28);
      doc.text("PIN: 203201", 14, 34);
      doc.text("Phone: 9955428948", 14, 40);
      doc.text("Email: nayantaeyewears@gmail.com", 14, 46);

      // Invoice info (right side)
      doc.setFontSize(14);
      doc.setTextColor(0, 0, 0);
      doc.text("INVOICE", 195, 20, null, null, "right");

      doc.setFontSize(10);
      doc.text(`Date: ${order.date}`, 195, 28, null, null, "right");
      doc.text(`Invoice #: ${order.invoiceNo}`, 195, 34, null, null, "right");

      // Bill To section
      doc.setFontSize(11);
      doc.setTextColor(0, 0, 0);
      doc.text("Bill To:", 14, 60);
      doc.setFontSize(10);
      doc.text(order.customer, 14, 66);
      doc.text(order.address, 14, 72);

      // Items Table
      doc.autoTable({
        startY: 85,
        head: [['Description', 'Qty', 'Unit Price (INR)', 'Total (INR)']],
        body: order.items.map(item => [
          item.description,
          item.qty,
          item.unit.toFixed(2),
          item.total.toFixed(2)
        ]),
        theme: 'grid',
        headStyles: { fillColor: [60, 60, 60], textColor: 255, fontStyle: 'bold' },
        styles: { fontSize: 10, halign: 'center' },
        alternateRowStyles: { fillColor: [245, 245, 245] },
      });

      let finalY = doc.lastAutoTable.finalY + 10;

      // Totals Table (right-aligned)
      doc.autoTable({
        startY: finalY,
        margin: { left: 120 },
        body: [
          ['Subtotal:', `INR ${order.subtotal.toFixed(2)}`],
          ['Paid:', `INR ${order.paid.toFixed(2)}`],
          ['Balance Due:', `INR ${order.due.toFixed(2)}`],
        ],
        theme: 'plain',
        styles: { fontSize: 10, halign: 'right' },
        bodyStyles: { fillColor: [250, 250, 250] },
      });

      finalY = doc.lastAutoTable.finalY + 10;

      // Notes
      doc.setFontSize(9);
      doc.setTextColor(100, 100, 100);
      doc.text("Notes: Invoice is necessary to claim warranty", 14, finalY);

      // Stamp (bottom-right)
      const stampUrl = "https://i.ibb.co/WN64wcDg/Red-and-White-Minimalist-Christmas-Circle-Sticker-removebg-preview.png";
      try {
        const img = await fetch(stampUrl).then(res => res.blob()).then(blob => {
          return new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(blob);
          });
        });
        doc.addImage(img, "PNG", 150, finalY + 10, 40, 40);
      } catch (e) {
        console.log("Stamp image not loaded.");
      }

      // Save
      doc.save(`Invoice_${order.invoiceNo}.pdf`);
    }
  </script>
</body>
</html>
